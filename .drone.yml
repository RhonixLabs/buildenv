branches:
  - master

clone:
  git-clone:
    image: plugins/git
    tags: true

pipeline:
  build:
    image: docker:stable
    commands:
      - apk add git bash alpine-sdk
      - make build-all
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock

  upload:
    image: docker:stable
    commands:
      - apk add git bash alpine-sdk
      - make push-all
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    secrets:
      - docker_username
      - docker_password
    when:
      branch: master
      event: [push, tag]
